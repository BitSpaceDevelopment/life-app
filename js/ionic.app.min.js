window.lifeApp={application:angular.module("lifeApp",["ionic","lifeApp.lib","lifeApp.controllers","lifeApp.services","ngResource","ng-token-auth","rails","ngRoute"]),controllers:angular.module("lifeApp.controllers",[]),services:angular.module("lifeApp.services",[]),lib:angular.module("lifeApp.lib",[])},lifeApp.application.config(function($httpProvider,$authProvider,$stateProvider,$urlRouterProvider){$httpProvider.defaults.withCredentials=!0,$authProvider.configure({apiUrl:"http://stage.lifeapp.bitspacedevelopment.com/api/v1"}),$stateProvider.state("tabs",{url:"/",templateUrl:"templates/tabs.html",controller:"UserSessionCtrl"}).state("tabs.home",{url:"home",views:{"home-tab":{templateUrl:"templates/home.html",controller:"UserSessionCtrl"}}}).state("tabs.about",{url:"about",views:{"about-tab":{templateUrl:"templates/about.html"}}}).state("tabs.contact",{url:"contact",views:{"contact-tab":{templateUrl:"templates/contact.html"}}}).state("tabs.landing",{url:"langding-page",views:{"home-tab":{templateUrl:"templates/landing.html"}}}).state("tabs.intro-survey",{url:"intro-survey",views:{"home-tab":{templateUrl:"templates/surveys.html",controller:"SurveyCtrl"}}}).state("tabs.life-survey",{url:"life-survey/:survey",views:{"home-tab":{templateUrl:"templates/life-survey.html",controller:"LifeSurveyCtrl"}}}).state("tabs.living-quiz",{url:"living-quiz/:survey",views:{"home-tab":{templateUrl:"templates/living-quiz.html",controller:"LivingQuizCtrl"}}}).state("tabs.survey-index",{url:"surveyindex",views:{"home-tab":{templateUrl:"templates/survey-index.html",controller:"SurveyIndexCtrl"}}}).state("tabs.resource-index",{url:"resources-index",views:{"home-tab":{templateUrl:"templates/resource-index.html",controller:"ResourceCategoryCtrl"}}}).state("tabs.resources",{url:"resources/:category",views:{"home-tab":{templateUrl:"templates/resources.html",controller:"ResourceCtrl"}}}).state("settings",{url:"settings",templateUrl:"templates/partial-settings.html"}).state("tabs.signin",{url:"signin",views:{"home-tab":{templateUrl:"templates/SignIn.html",controller:"UserSessionCtrl"}}}).state("tabs.signup",{url:"signup",views:{"home-tab":{templateUrl:"templates/SignUp.html",controller:"SignUpCtrl"}}}),$urlRouterProvider.otherwise("/")}),lifeApp.application.run(function($ionicPlatform){return $ionicPlatform.ready(function(){return window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar?StatusBar.styleLightContent():void 0})}),lifeApp.controllers.controller("SurveyCtrl",function($scope,$state,FirstTierQuestion,FirstTierSurvey,Question,Answer,Category,Flag){var index=0,score=0,surveyID=0,questionID=0,categoryID=0,totalLScore=0,totalIScore=0,totalEScore=0,totalFScore=0,questions=[],surveys=[],flag="";surveys=FirstTierSurvey.query(),surveys.$promise.then(function(data){surveyID=data[0].id,questions=FirstTierQuestion.query({surveyId:surveyID}),questions.$promise.then(function(results){questionID=results[index].id,categoryID=results[index].category.id,$scope.question=Question.get({id:questionID}),$scope.answers=Answer.query({questionId:questionID}),$scope.data={answers:""},$scope.next=function(answer){switch(score=answer.score,categoryID){case 2:totalLScore+=score;break;case 3:totalIScore+=score;break;case 4:totalFScore+=score;break;case 5:totalEScore+=score}if(index+=1,score=0,index>=results.length){var maxScore=Math.max(totalLScore,totalIScore,totalFScore,totalEScore);switch(maxScore){case totalLScore:flag="L";break;case totalIScore:flag="I";break;case totalFScore:flag="F";break;case totalEScore:flag="E"}Flag.setFlag(flag),$state.go("tabs.survey-index"),index=0}else questionID=results[index].id,categoryID=results[index].category.id,$scope.question=Question.get({id:questionID}),$scope.answers=Answer.query({questionId:questionID}),$scope.data={answers:""}}})})}),lifeApp.controllers.controller("LifeSurveyCtrl",function($scope,$stateParams,$state,FirstTierSurvey,FirstTierQuestion,SecondTierSurvey,RecommendResources,Recommend,Question,Answer){function recommendResources(id){resources=RecommendResources.query({questionId:id}),resources.$promise.then(function(resources){for(var i=0;i<resources.length;i++)Recommend.setRecommend(resources[i])})}var index=0,id=$stateParams.survey,questions=[],surveys=[],resources=[],firstTierSurveyID=0;SecondTierSurvey.query().$promise.then(function(results){firstTierSurveyID=results[0].survey_id,FirstTierSurvey.query().$promise.then(function(survey){firstTierSurveyID==id?($scope.showLQuiz=!0,$scope.showLiFEQuiz=!1,surveys=SecondTierSurvey.query({surveyId:id}),surveys.$promise.then(function(response){$scope.surveys=response})):($scope.showLQuiz=!1,$scope.showLiFEQuiz=!0,questions=FirstTierQuestion.query({surveyId:id}),questions.$promise.then(function(data){var qid=data[index].id;$scope.question=Question.get({id:qid}),$scope.answers=Answer.query({questionId:qid}),$scope.data={answers:""},$scope.next=function(answer){score=answer.score,score>0&&recommendResources(qid),index+=1,score=0,index>=data.length?($state.go("tabs.resources"),index=0):(qid=data[index].id,$scope.question=Question.get({id:qid}),$scope.answers=Answer.query({questionId:qid}),$scope.data={answers:""})}}))})})}),lifeApp.controllers.controller("LivingQuizCtrl",function($scope,$ionicActionSheet,$timeout,$state,$ionicPopup,$stateParams,Question,Answer,SecondTierSurvey,SecondTierQuestion,ThirdTierSurvey,ThirdTierQuestion,RecommendResources,Recommend){function showSurvey(questions){questions.$promise.then(function(data){var qid=data[number].id;$scope.question=Question.get({id:qid}),$scope.answers=Answer.query({questionId:qid}),$scope.data={answers:""},$scope.next=function(answer){score=answer.score,score>0&&recommendResources(qid),number+=1,number>=data.length?ids[0]==currentID?($scope.showOther=!0,$scope.showLiving=!1,$scope.showTrans=!1,questions=SecondTierQuestion.query({secondtiersurveyId:currentID}),showLSurvey(questions)):($state.go("tabs.resources"),number=0):(qid=data[number].id,$scope.question=Question.get({id:qid}),$scope.answers=Answer.query({questionId:qid}),$scope.data={answers:""})}})}function showBranches(){surveys=ThirdTierSurvey.query({secondtiersurveyId:currentID}),surveys.$promise.then(function(survey){for(var buttonsGroup=[],i=0;i<survey.length;i++){var text={text:survey[i].name};buttonsGroup.push(text)}var hideSheet=$ionicActionSheet.show({buttons:buttonsGroup,buttonClicked:function(index){$scope.toggled=!0;var sid=survey[index].id;return questions=ThirdTierQuestion.query({thirdtiersurveyId:sid}),showSurvey(questions),!0}});$timeout(function(){hideSheet()},5e3)})}function showLSurvey(questions){questions.$promise.then(function(response){var quesid=response[index].id;$scope.question=Question.get({id:quesid}),$scope.answers=Answer.query({questionId:quesid}),$scope.data={answers:""},$scope.next=function(answer){score=answer.score,score>0&&recommendResources(qid),index+=1,index>=response.length?($state.go("tabs.resources"),index=0):(quesid=response[index].id,$scope.question=Question.get({id:quesid}),$scope.answers=Answer.query({questionId:quesid}),$scope.data={answers:""})}})}function recommendResources(id){resources=RecommendResources.query({questionId:id}),resources.$promise.then(function(resources){for(var i=0;i<resources.length;i++)Recommend.setRecommend(resources[i])})}var id=$stateParams.survey,number=0,index=0,score=0,questions=[],surveys=[],resources=[],ids=[],seconTierSurveyID=0,currentID=id;ThirdTierSurvey.query().$promise.then(function(results){for(var i=0;i<results.length;i++)seconTierSurveyID=results[i].second_tier_survey_id,ids.push(seconTierSurveyID);ids[0]==currentID?($scope.showLiving=!0,$scope.showTrans=!1,$scope.showOther=!1,$scope.livingQuiz=function(){showBranches()}):ids[ids.length-1]==currentID?($scope.showTrans=!0,$scope.showLiving=!1,$scope.showOther=!1,$scope.transQuiz=function(){showBranches()}):($scope.showOther=!0,$scope.showLiving=!1,$scope.showTrans=!1,questions=SecondTierQuestion.query({secondtiersurveyId:currentID}),showSurvey(questions))})}),lifeApp.controllers.controller("ResourceCategoryCtrl",function($scope,resourceCategory){resourceCategory.query().$promise.then(function(response){$scope.resourceCategorys=response})}),lifeApp.controllers.controller("ResourceCtrl",function($scope,$stateParams,$ionicPopup,$state,Resource,Recommend,$http){var id=$stateParams.category,resources=[];resources=Recommend.getRecommend(),0==resources.length?($scope.showRecommend=!1,Resource.query({categoryId:id}).$promise.then(function(response){if($scope.resources=response,0==response.length){errormsg="Sorry, there doesn't seem to be any resources at this time";var confirm=$ionicPopup.confirm({title:errormsg});confirm.then(function(res){res?$state.go("tabs.resource-index"):$state.go("tabs.resource-index")})}})):($scope.showRecommend=!0,$scope.resources=resources,Recommend.setRecommend()),$scope.favouritedResource=function(id){url="http://stage.lifeapp.bitspacedevelopment.com/favourite/"+id+".json",$http.get(url).success(function(response){if(response.length>1){errormsg=response[0];$ionicPopup.confirm({title:errormsg,buttons:[{text:"Cancel",type:"button-default"},{text:"Log In",type:"button-positive",onTap:function(e){$state.go("tabs.signin")}}]})}else"true"==response?(document.getElementById(id).className="button button-assertive",document.getElementById(id+"icon").className="icon ion-ios-heart"):(document.getElementById(id).className="button button-energized",document.getElementById(id+"icon").className="icon ion-ios-star")})}}),lifeApp.controllers.controller("SignUpCtrl",function($scope,$state){$scope.handleRegBtnClick=function(){$auth.submitRegistration($scope.registrationForm).then(function(resp){$state.go("tabs.signin")})["catch"](function(error){$ionicPopup.alert({title:"Error",template:"An error occoured"})})}}),lifeApp.controllers.controller("SurveyIndexCtrl",function($scope,$ionicPopup,FirstTierSurvey,Flag){var ids=[];FirstTierSurvey.query().$promise.then(function(data){$scope.surveys=data;for(var i=0;i<data.length;i++)ids.push(data[i].id);var flag=Flag.getFlag();if(""!=flag){switch(flag){case"L":$scope.highlightId=ids[1];break;case"I":$scope.highlightId=ids[2];break;case"F":$scope.highlightId=ids[3];break;case"E":$scope.highlightId=ids[4];break;default:$scope.highlightId=ids[0]}$ionicPopup.alert({title:"Detailed Quiz",template:"We recommand you to take more detailed quiz"})}})}),lifeApp.controllers.controller("UserSessionCtrl",function($scope,$state,$window,UserSession,UserDestroy,$ionicPopup){$scope.flag=!1,window.localStorage.userId&&($scope.flag=!0),$scope.data={},$scope.signin=function(){var user_session=new UserSession({user:$scope.data});user_session.$save(function(data){window.localStorage.clear(),window.localStorage.userId=data.id,window.localStorage.userName=data.email,$window.location.reload(),$state.go("tabs.landing")},function(err){var error=err.data.error||err.data.join(". ");$ionicPopup.alert({title:"Error",template:error})})},$scope.signout=function(){var confirm=$ionicPopup.confirm({title:"Are you sure you want to logout?"});confirm.then(function(result){result&&UserDestroy.get().$promise.then(function(){window.localStorage.clear(),$window.location.reload(),$state.go("tabs.home")})})}});var indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};lifeApp.lib.constant("Module",function(){var Module;return Module=function(){function Module(){}return Module.KEYOWRDS=["extended","included"],Module.extend=function(obj){var key,ref,value;for(key in obj)value=obj[key],indexOf.call(Module.KEYOWRDS,key)<0&&(this[key]=value);return null!=(ref=obj.extended)&&ref.apply(this),this},Module.include=function(obj){var key,ref,value;for(key in obj)value=obj[key],indexOf.call(Module.KEYOWRDS,key)<0&&(this.prototype[key]=value);return null!=(ref=obj.included)&&ref.apply(this),this},Module}()}),lifeApp.services.factory("Answer",function($resource){return $resource("http://stage.lifeapp.bitspacedevelopment.com/:questionId/answers/:id",{questionId:"@questionId",id:"@id"})}),lifeApp.services.factory("Category",function($resource){return $resource("http://stage.lifeapp.bitspacedevelopment.com/:questionId/categories/:id",{questionId:"@questionId",id:"@id"})}),lifeApp.services.factory("FirstTierQuestion",function($resource){return $resource("http://stage.lifeapp.bitspacedevelopment.com/surveyQuestions/:surveyId",{surveyId:"@id"})}),lifeApp.services.factory("FirstTierSurvey",function($resource){return $resource("http://stage.lifeapp.bitspacedevelopment.com/surveys/:id",{id:"@id"})}),lifeApp.services.factory("Flag",function(){var flag="",setFlag=function(newFlag){flag=0==arguments.length?"":newFlag},getFlag=function(){return flag};return{setFlag:setFlag,getFlag:getFlag}}),lifeApp.services.factory("Question",function($resource){return $resource("http://stage.lifeapp.bitspacedevelopment.com/questions/:id",{id:"@id"})}),lifeApp.services.factory("Recommend",function(){var resources=[],setRecommend=function(newResource){0==arguments.length?resources=[]:resources.push(newResource)},getRecommend=function(){return resources};return{setRecommend:setRecommend,getRecommend:getRecommend}}),lifeApp.services.factory("RecommendResources",function($resource){return $resource("http://stage.lifeapp.bitspacedevelopment.com/recommendResources/:questionId",{questionId:"@id"})}),lifeApp.services.factory("Resource",function($resource){return $resource("http://stage.lifeapp.bitspacedevelopment.com/:categoryId",{categoryId:"@id"})}),lifeApp.services.factory("resourceCategory",function($resource){return $resource("http://stage.lifeapp.bitspacedevelopment.com/resources-list/:id.json")}),lifeApp.services.factory("SecondTierQuestion",function($resource){return $resource("http://stage.lifeapp.bitspacedevelopment.com/secondTierQuestions/:secondtiersurveyId",{secondtiersurveyId:"@id"})}),lifeApp.services.factory("SecondTierSurvey",function($resource){return $resource("http://stage.lifeapp.bitspacedevelopment.com/secondTierSurveys/:surveyId",{surveyId:"@id"})}),lifeApp.services.factory("ThirdTierQuestion",function($resource){return $resource("http://stage.lifeapp.bitspacedevelopment.com/thirdTierQuestions/:thirdtiersurveyId",{thirdtiersurveyId:"@id"})}),lifeApp.services.factory("ThirdTierSurvey",function($resource){return $resource("http://stage.lifeapp.bitspacedevelopment.com/thirdTierSurveys/:secondtiersurveyId",{secondtiersurveyId:"@id"})}),lifeApp.services.factory("UserDestroy",function($resource){return $resource("http://stage.lifeapp.bitspacedevelopment.com/users/sign_out.json")}),lifeApp.services.factory("UserSession",function($resource){return $resource("http://stage.lifeapp.bitspacedevelopment.com/users/sign_in.json")});