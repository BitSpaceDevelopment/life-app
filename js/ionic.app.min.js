window.lifeApp={application:angular.module("lifeApp",["ionic","lifeApp.lib","lifeApp.controllers","lifeApp.services","ngResource","ng-token-auth","rails","ngRoute"]),controllers:angular.module("lifeApp.controllers",[]),services:angular.module("lifeApp.services",[]),lib:angular.module("lifeApp.lib",[])},window.env={apiUrl:"http://localhost:3000/api/v1"},lifeApp.application.config(function($httpProvider,$authProvider,$stateProvider,$urlRouterProvider){$httpProvider.defaults.withCredentials=!0,$stateProvider.state("tabs",{url:"/",templateUrl:"templates/tabs.html",controller:"UserSessionCtrl"}).state("tabs.home",{url:"home",views:{"home-tab":{templateUrl:"templates/home.html",controller:"UserSessionCtrl"}}}).state("tabs.landing",{url:"landing-page",views:{"home-tab":{templateUrl:"templates/landing.html"}},resolve:{auth:function($auth){return $auth.validateUser()}}}).state("tabs.intro-survey",{url:"intro-survey",views:{"home-tab":{templateUrl:"templates/surveys.html",controller:"IntroSurveyCtrl"}},resolve:{auth:function($auth){return $auth.validateUser()}}}).state("tabs.survey",{url:"survey/:survey",views:{"home-tab":{templateUrl:"templates/survey.html",controller:"SurveyCtrl"}},resolve:{auth:function($auth){return $auth.validateUser()}}}).state("tabs.living-quiz",{url:"living-quiz/:survey",views:{"home-tab":{templateUrl:"templates/living-quiz.html",controller:"LivingQuizCtrl"}},resolve:{auth:function($auth){return $auth.validateUser()}}}).state("tabs.survey-index",{url:"survey/categories",views:{"home-tab":{templateUrl:"templates/survey-index.html",controller:"SurveyIndexCtrl"}},resolve:{auth:function($auth){return $auth.validateUser()}}}).state("tabs.surveys",{url:"survey/categories/:id",views:{"home-tab":{templateUrl:"templates/surveys.html",controller:"SurveysCtrl"}},resolve:{auth:function($auth){return $auth.validateUser()}}}).state("tabs.resource-index",{url:"resourcesindex",views:{"home-tab":{templateUrl:"templates/resource-index.html",controller:"CategoryIndexCtrl"}}}).state("tabs.resources",{url:"resources/:categoryId",views:{"home-tab":{templateUrl:"templates/resources.html",controller:"ResourceCtrl"}}}).state("tabs.signin",{url:"signin",views:{"home-tab":{templateUrl:"templates/SignIn.html",controller:"UserSessionCtrl"}}}).state("tabs.signup",{url:"signup",views:{"home-tab":{templateUrl:"templates/SignUp.html",controller:"SignUpCtrl"}}}),$urlRouterProvider.otherwise("home")}),lifeApp.application.run(function($ionicPlatform){return $ionicPlatform.ready(function(){return window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar?StatusBar.styleLightContent():void 0})}),lifeApp.controllers.controller("CategoryIndexCtrl",function($scope,Category){Category.query().$promise.then(function(response){$scope.categorys=response})}),lifeApp.controllers.controller("HomePropertiesCtrl",function($scope,$http){$http.get(env.apiUrl+"/property/home").then(function(resp){$scope.home=resp.data})}),lifeApp.controllers.controller("IntroSurveyCtrl",function($scope,$state,SurveyQuestion,FirstTierSurvey,Question,Answer,Category,Flag){var index=0,score=0,surveyID=0,questionID=0,categoryID=0,totalLScore=0,totalIScore=0,totalEScore=0,totalFScore=0,questions=[],surveys=[],flag="";surveys=FirstTierSurvey.query(),surveys.$promise.then(function(data){surveyID=data[0].id,questions=SurveyQuestion.query({id:surveyID}),questions.$promise.then(function(results){questionID=results[index].id,categoryID=results[index].category.id,$scope.question=Question.get({id:questionID}),$scope.answers=Answer.query({questionId:questionID}),$scope.data={answers:""},$scope.next=function(answer){switch(score=answer.score,categoryID){case 2:totalLScore+=score;break;case 3:totalIScore+=score;break;case 4:totalFScore+=score;break;case 5:totalEScore+=score}if(index+=1,score=0,index>=results.length){var maxScore=Math.max(totalLScore,totalIScore,totalFScore,totalEScore);switch(maxScore){case totalLScore:flag="L";break;case totalIScore:flag="I";break;case totalFScore:flag="F";break;case totalEScore:flag="E"}Flag.setFlag(flag),$state.go("tabs.survey-index"),index=0}else questionID=results[index].id,categoryID=results[index].category.id,$scope.question=Question.get({id:questionID}),$scope.answers=Answer.query({questionId:questionID}),$scope.data={answers:""}}})})}),lifeApp.controllers.controller("LandingPropertiesCtrl",function($scope,$http){$http.get(env.apiUrl+"/property/about").then(function(resp){$scope.about=resp.data})}),lifeApp.controllers.controller("LivingQuizCtrl",function($scope,$ionicActionSheet,$timeout,$state,$ionicPopup,$stateParams,Question,Answer,SecondTierSurvey,SecondTierQuestion,ThirdTierSurvey,ThirdTierQuestion,RecommendResources,Recommend){function showSurvey(questions){questions.$promise.then(function(data){var qid=data[number].id;$scope.question=Question.get({id:qid}),$scope.answers=Answer.query({questionId:qid}),$scope.data={answers:""},$scope.next=function(answer){score=answer.score,score>0&&recommendResources(qid),number+=1,number>=data.length?ids[0]==currentID?($scope.showOther=!0,$scope.showLiving=!1,$scope.showTrans=!1,questions=SecondTierQuestion.query({secondtiersurveyId:currentID}),showLSurvey(questions)):($state.go("tabs.resources"),number=0):(qid=data[number].id,$scope.question=Question.get({id:qid}),$scope.answers=Answer.query({questionId:qid}),$scope.data={answers:""})}})}function showBranches(){surveys=ThirdTierSurvey.query({secondtiersurveyId:currentID}),surveys.$promise.then(function(survey){for(var buttonsGroup=[],i=0;i<survey.length;i++){var text={text:survey[i].name};buttonsGroup.push(text)}var hideSheet=$ionicActionSheet.show({buttons:buttonsGroup,buttonClicked:function(index){$scope.toggled=!0;var sid=survey[index].id;return questions=ThirdTierQuestion.query({thirdtiersurveyId:sid}),showSurvey(questions),!0}});$timeout(function(){hideSheet()},5e3)})}function showLSurvey(questions){questions.$promise.then(function(response){var quesid=response[index].id;$scope.question=Question.get({id:quesid}),$scope.answers=Answer.query({questionId:quesid}),$scope.data={answers:""},$scope.next=function(answer){score=answer.score,score>0&&recommendResources(qid),index+=1,index>=response.length?($state.go("tabs.resources"),index=0):(quesid=response[index].id,$scope.question=Question.get({id:quesid}),$scope.answers=Answer.query({questionId:quesid}),$scope.data={answers:""})}})}function recommendResources(id){resources=RecommendResources.query({questionId:id}),resources.$promise.then(function(resources){for(var i=0;i<resources.length;i++)Recommend.setRecommend(resources[i])})}var id=$stateParams.survey,number=0,index=0,score=0,questions=[],surveys=[],resources=[],ids=[],seconTierSurveyID=0,currentID=id;ThirdTierSurvey.query().$promise.then(function(results){for(var i=0;i<results.length;i++)seconTierSurveyID=results[i].second_tier_survey_id,ids.push(seconTierSurveyID);ids[0]==currentID?($scope.showLiving=!0,$scope.showTrans=!1,$scope.showOther=!1,$scope.livingQuiz=function(){showBranches()}):ids[ids.length-1]==currentID?($scope.showTrans=!0,$scope.showLiving=!1,$scope.showOther=!1,$scope.transQuiz=function(){showBranches()}):($scope.showOther=!0,$scope.showLiving=!1,$scope.showTrans=!1,questions=SecondTierQuestion.query({secondtiersurveyId:currentID}),showSurvey(questions))})}),lifeApp.controllers.controller("ResourceCtrl",function($scope,$stateParams,$ionicPopup,$state,Resource,AllResources,$http,$auth){var id=$stateParams.categoryId,resourceProvider=id?Resource.query({categoryId:id}):AllResources.query();resourceProvider.$promise.then(function(response){if($scope.resources=response,0==response.length){errormsg="Sorry, there doesn't seem to be any resources at this time";var confirm=$ionicPopup.confirm({title:errormsg});confirm.then(function(res){res?$state.go("tabs.resource-index"):$state.go("tabs.resource-index")})}}),$scope.favouritedResource=function(id){url=env.apiUrl+"/favourite/"+id,$http.get(url).success(function(response){if(response.length>1){errormsg=response[0];$ionicPopup.confirm({title:errormsg,buttons:[{text:"Cancel",type:"button-default"},{text:"Log In",type:"button-positive",onTap:function(e){$state.go("tabs.signin")}}]})}else"true"==response?(document.getElementById(id).className="button button-assertive",document.getElementById(id+"icon").className="icon ion-ios-heart"):(document.getElementById(id).className="button button-energized",document.getElementById(id+"icon").className="icon ion-ios-star")})}}),lifeApp.controllers.controller("SignInCtrl",function($scope,$state,UserSession,$ionicPopup){$scope.data={},$scope.signin=function(){var user_session=new UserSession({user:$scope.data});user_session.$save(function(data){window.localStorage.clear(),window.localStorage.userId=data.id,window.localStorage.userName=data.name,$state.go("tabs.about")},function(err){var error=err.data.error||err.data.join(". ");$ionicPopup.alert({title:"Error",template:error})})}}),lifeApp.controllers.controller("SignUpCtrl",function($scope,$state){$scope.handleRegBtnClick=function(){$auth.submitRegistration($scope.registrationForm).then(function(user){$state.go("tabs.signin")})["catch"](function(error){$ionicPopup.alert({title:"Error",template:"An error occurred."})})}}),lifeApp.controllers.controller("SurveyCtrl",function($scope,$stateParams,$state,SurveyQuestion,RecommendResources){var id=$stateParams.survey;SurveyQuestion.query({id:id}).$promise.then(function(response){$scope.questions=response;var question_index=0;$scope.question=response[question_index],$scope.end=!1,$scope.showResources=!1;var resources=[],scoreArray=[];response.length;$scope.next=function(answer){if(score=answer.score,scoreArray.push(score),question_index>=$scope.questions.length-1){var totalNumber=0;$scope.end=!0;for(var i=0;i<scoreArray.length;i++)totalNumber+=scoreArray[i];totalNumber>0&&($scope.showResources=!0,$scope.showResources=resources)}else{if(score>0){var id=response[question_index].id;resources.push(RecommendResources.query({questionId:id}))}question_index++,$scope.question=response[question_index]}}})}),lifeApp.controllers.controller("SurveyIndexCtrl",function($scope,$ionicPopup,$http){$http.get(env.apiUrl+"/categories").then(function(resp){$scope.categories=resp.data})}),lifeApp.controllers.controller("SurveysCtrl",function($scope,$stateParams,$http){var id=$stateParams.id;$http.get(env.apiUrl+"/categories/"+id+"/surveys").then(function(resp){$scope.surveys=resp.data,$scope.category=$scope.surveys[0].category.category})}),lifeApp.controllers.controller("UserSessionCtrl",function($scope,$state,$window,$ionicPopup,$auth,$ionicHistory){$scope.user=$auth.user,$scope.data={},$scope.signin=function(){$auth.submitLogin($scope.data).then(function(user){$ionicHistory.nextViewOptions({disableBack:!0}),user.intro_quiz?$state.go("tabs.survey-index"):$state.go("tabs.landing")})["catch"](function(data){console.log(data),$ionicPopup.alert({title:"Error!",template:data.errors})})},$scope.signout=function(){var confirm=$ionicPopup.confirm({title:"Are you sure you want to logout?"});confirm.then(function(result){result&&$auth.signOut().then(function(){$ionicHistory.nextViewOptions({disableBack:!0}),$state.go("tabs.home")})["catch"](function(resp){console.error(resp),$ionicPopup.alert({title:"Error!",template:"There was an error logging you out."})})})}});var indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};lifeApp.lib.constant("Module",function(){var Module;return Module=function(){function Module(){}return Module.KEYOWRDS=["extended","included"],Module.extend=function(obj){var key,ref,value;for(key in obj)value=obj[key],indexOf.call(Module.KEYOWRDS,key)<0&&(this[key]=value);return null!=(ref=obj.extended)&&ref.apply(this),this},Module.include=function(obj){var key,ref,value;for(key in obj)value=obj[key],indexOf.call(Module.KEYOWRDS,key)<0&&(this.prototype[key]=value);return null!=(ref=obj.included)&&ref.apply(this),this},Module}()}),lifeApp.application.config(function($authProvider){$authProvider.configure({apiUrl:env.apiUrl,storage:"localStorage"})}),lifeApp.services.factory("AllResources",function($resource){return $resource(env.apiUrl+"/resources")}),lifeApp.services.factory("Answer",function($resource){return $resource(env.apiUrl+"/answers/:questionId",{questionId:"@questionId"})}),lifeApp.services.factory("Category",function($resource){return $resource(env.apiUrl+"/categories/:id")}),lifeApp.services.factory("FirstTierQuestion",function($resource){return $resource("http://localhost:3000/surveyQuestions/:surveyId",{surveyId:"@id"})}),lifeApp.services.factory("FirstTierSurvey",function($resource){return $resource(env.apiUrl+"/surveys/:id",{id:"@id"})}),lifeApp.services.factory("Flag",function(){var flag="",setFlag=function(newFlag){flag=0==arguments.length?"":newFlag},getFlag=function(){return flag};return{setFlag:setFlag,getFlag:getFlag}}),lifeApp.services.factory("Question",function($resource){return $resource(env.apiUrl+"/questions/:id",{id:"@id"})}),lifeApp.services.factory("Recommend",function(){var resources=[],setRecommend=function(newResource){0==arguments.length?resources=[]:resources.push(newResource)},getRecommend=function(){return resources};return{setRecommend:setRecommend,getRecommend:getRecommend}}),lifeApp.services.factory("RecommendResources",function($resource){return $resource(env.apiUrl+"/recommendResources/:questionId",{questionId:"@id"})}),lifeApp.services.factory("Resource",function($resource){return $resource(env.apiUrl+"/categories/:categoryId/resources",{categoryId:"@id"})}),lifeApp.services.factory("SecondTierQuestion",function($resource){return $resource(env.apiUrl+"/secondTierQuestions/:secondtiersurveyId",{secondtiersurveyId:"@id"})}),lifeApp.services.factory("SecondTierSurvey",function($resource){return $resource(env.apiUrl+"/secondTierSurveys/:surveyId",{surveyId:"@id"})}),lifeApp.services.factory("SurveyQuestion",function($resource){return $resource(env.apiUrl+"/surveyQuestions/:id")}),lifeApp.services.factory("ThirdTierQuestion",function($resource){return $resource(env.apiUrl+"/thirdTierQuestions/:thirdtiersurveyId",{thirdtiersurveyId:"@id"})}),lifeApp.services.factory("ThirdTierSurvey",function($resource){return $resource(env.apiUrl+"/thirdTierSurveys/:secondtiersurveyId",{secondtiersurveyId:"@id"})}),lifeApp.services.factory("UserDestroy",function($resource){return $resource("http://localhost:3000/users/sign_out.json")}),lifeApp.services.factory("UserSession",function($resource){return $resource("http://localhost:3000/users/sign_in.json")});