window.lifeApp={application:angular.module("lifeApp",["ionic","lifeApp.lib","lifeApp.controllers","lifeApp.services","ngResource","ng-token-auth","rails","ngRoute","ngSanitize"]),controllers:angular.module("lifeApp.controllers",[]),services:angular.module("lifeApp.services",[]),lib:angular.module("lifeApp.lib",[])},window.env={apiUrl:"http://stage.lifeapp.bitspacedevelopment.com/api/v1"},lifeApp.application.config(function($httpProvider,$authProvider,$stateProvider,$urlRouterProvider){$httpProvider.defaults.withCredentials=!0,$stateProvider.state("tabs",{url:"/",templateUrl:"templates/tabs.html",controller:"UserSessionCtrl"}).state("tabs.home",{url:"home",views:{"home-tab":{templateUrl:"templates/home.html",controller:"UserSessionCtrl"}}}).state("tabs.landing",{url:"landing-page",views:{"home-tab":{templateUrl:"templates/landing.html"}},resolve:{auth:function($auth){return $auth.validateUser()}}}).state("tabs.intro-survey",{url:"intro-survey",views:{"home-tab":{templateUrl:"templates/intro-survey.html",controller:"IntroSurveyCtrl"}},resolve:{auth:function($auth){return $auth.validateUser()}}}).state("tabs.survey",{url:"survey/:id",views:{"home-tab":{templateUrl:"templates/survey.html",controller:"SurveyCtrl"}},resolve:{auth:function($auth){return $auth.validateUser()}}}).state("tabs.survey-index",{url:"survey/categories",views:{"home-tab":{templateUrl:"templates/survey-index.html",controller:"SurveyIndexCtrl"}},resolve:{auth:function($auth){return $auth.validateUser()}}}).state("tabs.resource-index",{url:"resourcesindex",views:{"home-tab":{templateUrl:"templates/resource-index.html",controller:"CategoryIndexCtrl"}}}).state("tabs.resources",{url:"resources/:categoryId",views:{"home-tab":{templateUrl:"templates/resources.html",controller:"ResourceCtrl"}}}).state("tabs.signin",{url:"signin",views:{"home-tab":{templateUrl:"templates/SignIn.html",controller:"UserSessionCtrl"}}}).state("tabs.signup",{url:"signup",views:{"home-tab":{templateUrl:"templates/SignUp.html",controller:"SignUpCtrl"}}}),$urlRouterProvider.otherwise("home")}),lifeApp.application.run(function($ionicPlatform){return $ionicPlatform.ready(function(){return window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar?StatusBar.styleLightContent():void 0})}),lifeApp.controllers.controller("CategoryIndexCtrl",function($scope,Category){Category.query().$promise.then(function(response){$scope.categorys=response})}),lifeApp.controllers.controller("HomePropertiesCtrl",function($scope,$http){$http.get(env.apiUrl+"/property/home").then(function(resp){$scope.home=resp.data})}),lifeApp.controllers.controller("IntroSurveyCtrl",function($scope,$state,$auth,IntroSurvey,User,Response){var index=0,userID=0;$scope.user=$auth.user,userID=$auth.user.id;var user=User.get({id:userID});IntroSurvey.query().$promise.then(function(results){function showIntroSurvey(index){$scope.question=results[index],$scope.answers=results[index].intro_answers,$scope.data={answers:""},$scope.next=function(answer){var response=new Response;response.answer_id=answer.id,response.user_id=userID,response.$save(),user.question_id=results[index].id,user.intro_quiz=!1,User.update({id:userID},user),index++,score=0,index>results.length-1?(user.intro_quiz=!0,User.update({id:userID},user),$state.go("tabs.survey-index"),index=0):($scope.question=results[index],$scope.answers=results[index].intro_answers,$scope.data={answers:""})}}if($scope.questions=results,null!=user.question_id){for(var i=0;i<results.length-1;i++)user.question_id==results[i].id&&(index=i);showIntroSurvey(index)}else index=0,showIntroSurvey(index)})}),lifeApp.controllers.controller("LandingPropertiesCtrl",function($scope,$http){$http.get(env.apiUrl+"/property/about").then(function(resp){$scope.about=resp.data})}),lifeApp.controllers.controller("ResourceCtrl",function($scope,$stateParams,$ionicPopup,$state,Resource,AllResources,$http,$auth){var id=$stateParams.categoryId,resourceProvider=id?Resource.query({categoryId:id}):AllResources.query();resourceProvider.$promise.then(function(response){if($scope.resources=response,0==response.length){errormsg="Sorry, there doesn't seem to be any resources at this time";var confirm=$ionicPopup.confirm({title:errormsg});confirm.then(function(res){res?$state.go("tabs.resource-index"):$state.go("tabs.resource-index")})}}),$scope.favouritedResource=function(id){url=env.apiUrl+"/favourite/"+id,$http.get(url).success(function(response){if(response.length>1){errormsg=response[0];$ionicPopup.confirm({title:errormsg,buttons:[{text:"Cancel",type:"button-default"},{text:"Log In",type:"button-positive",onTap:function(e){$state.go("tabs.signin")}}]})}else"true"==response?(document.getElementById(id).className="button button-assertive",document.getElementById(id+"icon").className="icon ion-ios-heart"):(document.getElementById(id).className="button button-energized",document.getElementById(id+"icon").className="icon ion-ios-star")})}}),lifeApp.controllers.controller("SignUpCtrl",function($scope,$state,$ionicPopup,$auth,$ionicHistory){$scope.submitReg=function(data){$auth.submitRegistration(data).then(function(user){$auth.submitLogin(data).then(function(user){$ionicHistory.nextViewOptions({disableBack:!0}),user.intro_quiz?$state.go("tabs.survey-index"):$state.go("tabs.landing")})})["catch"](function(error){$ionicPopup.alert({title:"Error",template:"An error occurred."})})}}),lifeApp.controllers.controller("SurveyCtrl",function($scope,$stateParams,$auth,$http,SecondTierQuestion,RecommendResources,Survey,SurveyQuestion){var category_id=$stateParams.id,score=0,index=0,totalScore=0,resources=[],scores=[];$scope.user=$auth.user;var user_id=$auth.user.id;$http.get(env.apiUrl+"/responses/"+user_id).then(function(resp){function buildQuestion(index){SecondTierQuestion.query({introAnswerId:resp.data[index].answer_id,categoryId:category_id}).$promise.then(function(results){if(0!=results.length){$scope.end=!1,$scope.showResources=!1,$scope.questions=results;var question_index=0;$scope.data={answers:""},$scope.question=results[question_index],$scope.answers=results[question_index].answers,$scope.next=function(answer){score=answer.score,scores.push(score),score>0&&resources.push(RecommendResources.query({questionId:results[question_index].id})),question_index++,question_index>results.length-1?checkNext(index):($scope.data={answers:""},$scope.question=results[question_index],$scope.answers=results[question_index].answers)}}else checkNext(index)})}function checkNext(index){index++,index>resp.data.length-1?Survey.query({id:category_id}).$promise.then(function(survey){if(0!=survey.length){var s_id=survey[0].id;SurveyQuestion.query({id:s_id}).$promise.then(function(questions){if(0!=questions.length){$scope.questions=questions;var q_index=0;$scope.data={answers:""},$scope.question=questions[q_index],$scope.answers=questions[q_index].answers,$scope.next=function(answer){score=answer.score,scores.push(score),score>0&&resources.push(RecommendResources.query({questionId:questions[q_index].id})),q_index++,q_index>questions.length-1?showResources():($scope.data={answers:""},$scope.question=questions[q_index],$scope.answers=questions[q_index].answers)}}else showResources()})}else showResources()}):buildQuestion(index)}function showResources(){$scope.end=!0;for(var i=0;i<scores.length-1;i++)totalScore+=scores[i];totalScore>0&&($scope.showResources=!0,$scope.showResources=resources)}buildQuestion(index)})}),lifeApp.controllers.controller("SurveyEndPropertiesCtrl",function($scope,$http){$http.get(env.apiUrl+"/property/surveyend").then(function(resp){$scope.surveyend=resp.data})}),lifeApp.controllers.controller("SurveyIndexCtrl",function($scope,$ionicPopup,$http){$http.get(env.apiUrl+"/categories").then(function(resp){$scope.categories=resp.data})}),lifeApp.controllers.controller("UserSessionCtrl",function($scope,$state,$window,$ionicPopup,$auth,$ionicHistory){$scope.user=$auth.user,$scope.data={},$scope.signin=function(){$auth.submitLogin($scope.data).then(function(user){$ionicHistory.nextViewOptions({disableBack:!0}),user.intro_quiz?$state.go("tabs.survey-index"):$state.go("tabs.landing")})["catch"](function(data){console.log(data),$ionicPopup.alert({title:"Error!",template:data.errors})})},$scope.signout=function(){var confirm=$ionicPopup.confirm({title:"Are you sure you want to logout?"});confirm.then(function(result){result&&$auth.signOut().then(function(){$ionicHistory.nextViewOptions({disableBack:!0}),$state.go("tabs.home")})["catch"](function(resp){console.error(resp),$ionicPopup.alert({title:"Error!",template:"There was an error logging you out."})})})}});var indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};lifeApp.lib.constant("Module",function(){var Module;return Module=function(){function Module(){}return Module.KEYOWRDS=["extended","included"],Module.extend=function(obj){var key,ref,value;for(key in obj)value=obj[key],indexOf.call(Module.KEYOWRDS,key)<0&&(this[key]=value);return null!=(ref=obj.extended)&&ref.apply(this),this},Module.include=function(obj){var key,ref,value;for(key in obj)value=obj[key],indexOf.call(Module.KEYOWRDS,key)<0&&(this.prototype[key]=value);return null!=(ref=obj.included)&&ref.apply(this),this},Module}()}),lifeApp.application.config(function($authProvider){$authProvider.configure({apiUrl:env.apiUrl,storage:"localStorage"})}),lifeApp.services.factory("AllResources",function($resource){return $resource(env.apiUrl+"/resources")}),lifeApp.services.factory("Category",function($resource){return $resource(env.apiUrl+"/categories/:id")}),lifeApp.services.factory("User",function($resource){return $resource(env.apiUrl+"/user/:id",{id:"@id"},{update:{method:"PUT"}})}),lifeApp.services.factory("IntroSurvey",function($resource){return $resource(env.apiUrl+"/introQuestions")}),lifeApp.services.factory("Question",function($resource){return $resource(env.apiUrl+"/questions/:id",{id:"@id"})}),lifeApp.services.factory("RecommendResources",function($resource){return $resource(env.apiUrl+"/recommendResources/:questionId",{questionId:"@id"})}),lifeApp.services.factory("Resource",function($resource){return $resource(env.apiUrl+"/categories/:categoryId/resources",{categoryId:"@id"})}),lifeApp.services.factory("Response",function($resource){return $resource(env.apiUrl+"/response")}),lifeApp.services.factory("SecondTierQuestion",function($resource){return $resource(env.apiUrl+"/secondTierQuestions/:introAnswerId/:categoryId",{introAnswerId:"@intro_answer_id",categoryId:"@category_id"})}),lifeApp.services.factory("Survey",function($resource){return $resource(env.apiUrl+"/universalSurveys/:id",{id:"@id"})}),lifeApp.services.factory("SurveyQuestion",function($resource){return $resource(env.apiUrl+"/surveyQuestions/:id")}),lifeApp.services.factory("UserSession",function($resource){return $resource("http://stage.lifeapp.bitspacedevelopment.com/api/v1/users/sign_in.json")});