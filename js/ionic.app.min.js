window.lifeApp={application:angular.module("lifeApp",["ionic","lifeApp.lib","lifeApp.controllers","lifeApp.services","ngResource","ng-token-auth","rails","ngRoute","ngSanitize"]),controllers:angular.module("lifeApp.controllers",[]),services:angular.module("lifeApp.services",[]),lib:angular.module("lifeApp.lib",[])},lifeApp.application.config(function($httpProvider,$authProvider,$stateProvider,$urlRouterProvider){$httpProvider.defaults.withCredentials=!0,$stateProvider.state("tabs",{url:"/",templateUrl:"templates/tabs.html",controller:"UserSessionCtrl"}).state("tabs.home",{url:"home",views:{"home-tab":{templateUrl:"templates/home.html",controller:"UserSessionCtrl"}}}).state("tabs.landing",{url:"landing-page",views:{"home-tab":{templateUrl:"templates/landing.html"}},resolve:{auth:function($auth){return $auth.validateUser()}}}).state("tabs.intro-survey",{url:"intro-survey",resolve:{auth:function($auth){return $auth.validateUser()},introQuestions:function(IntroQuestion){return IntroQuestion.query()}},views:{"home-tab":{templateUrl:"templates/intro-question.html",controller:"IntroQuestionCtrl"}}}).state("tabs.survey",{url:"survey/{id:int}",views:{"home-tab":{templateUrl:"templates/survey.html",controller:"SurveyCtrl"}},resolve:{auth:function($auth){return $auth.validateUser()}}}).state("tabs.survey-index",{url:"survey/categories",views:{"home-tab":{templateUrl:"templates/survey-index.html",controller:"SurveyIndexCtrl"}},resolve:{auth:function($auth){return $auth.validateUser()}}}).state("tabs.resource-index",{url:"resourcesindex",views:{"home-tab":{templateUrl:"templates/resource-index.html",controller:"CategoryIndexCtrl"}}}).state("tabs.resources",{url:"resources/:categoryId",views:{"home-tab":{templateUrl:"templates/resources.html",controller:"ResourceCtrl"}}}).state("tabs.signin",{url:"signin",views:{"home-tab":{templateUrl:"templates/SignIn.html",controller:"UserSessionCtrl"}}}).state("tabs.signup",{url:"signup",views:{"home-tab":{templateUrl:"templates/SignUp.html",controller:"SignUpCtrl"}}}),$urlRouterProvider.otherwise("home")}),lifeApp.application.run(function($ionicPlatform){return $ionicPlatform.ready(function(){return window.cordova&&window.cordova.plugins&&window.cordova.plugins.Keyboard&&(cordova.plugins.Keyboard.hideKeyboardAccessoryBar(!0),cordova.plugins.Keyboard.disableScroll(!0)),window.StatusBar?StatusBar.styleLightContent():void 0})});var indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};lifeApp.lib.constant("Module",function(){var Module;return Module=function(){function Module(){}return Module.KEYOWRDS=["extended","included"],Module.extend=function(obj){var key,ref,value;for(key in obj)value=obj[key],indexOf.call(Module.KEYOWRDS,key)<0&&(this[key]=value);return null!=(ref=obj.extended)&&ref.apply(this),this},Module.include=function(obj){var key,ref,value;for(key in obj)value=obj[key],indexOf.call(Module.KEYOWRDS,key)<0&&(this.prototype[key]=value);return null!=(ref=obj.included)&&ref.apply(this),this},Module}()}),lifeApp.controllers.controller("CategoryIndexCtrl",function($scope,Category){Category.query().$promise.then(function(response){$scope.categorys=response})}),lifeApp.controllers.controller("HomePropertiesCtrl",function($scope,Property){var homeProps=["home","home_logged_in","home_logged_out"];homeProps.forEach(function(name){Property.get({name:name},function(prop){$scope[name]=prop})})}),lifeApp.controllers.controller("IntroQuestionCtrl",function($scope,$state,introQuestions,IntroQuestion,IntroResponse,User){$scope.intro_questions=introQuestions,$scope.questionIndex=0,$scope.respondWith=function(introAnswer){IntroResponse.create({intro_answer_id:introAnswer.id},{},function(introResponse){$scope.questionIndex+=1,$scope.questionIndex>=$scope.intro_questions.length&&$scope.introCompleted()})},$scope.introCompleted=function(){IntroQuestion.complete(function(complete){User.get(function(user){$scope.user=user,$state.go("tabs.survey-index")})})}}),lifeApp.controllers.controller("LandingPropertiesCtrl",function($scope,Property){Property.get({name:"about"},function(prop){$scope.about=prop})}),lifeApp.controllers.controller("ResourceCtrl",function($scope,$stateParams,$ionicPopup,$state,Resource,AllResources,$http,$auth){var id=$stateParams.categoryId,resourceProvider=id?Resource.query({category_id:id}):AllResources.query();resourceProvider.$promise.then(function(response){if($scope.resources=response,0==response.length){errormsg="Sorry, there doesn't seem to be any resources at this time";var confirm=$ionicPopup.confirm({title:errormsg});confirm.then(function(res){res?$state.go("tabs.resource-index"):$state.go("tabs.resource-index")})}}),$scope.favouritedResource=function(resource){var url=env.apiUrl;url+=resource.favourite?"/resources/"+id+"/unfavourite":"/resources/"+id+"/favourite",$http.put(url).then(function(response){resource.favourite=response.data.favourite})["catch"](function(error){if(401==error.status){var errorMsg=error.data.errors[0];$ionicPopup.confirm({title:errorMsg,buttons:[{text:"Cancel",type:"button-default"},{text:"Log In",type:"button-positive",onTap:function(e){$state.go("tabs.signin")}}]})}})}}),lifeApp.controllers.controller("SignUpCtrl",function($scope,$state,$ionicPopup,$auth,$ionicHistory){$scope.submitReg=function(data){$auth.submitRegistration(data).then(function(user){$auth.submitLogin(data).then(function(user){$ionicHistory.nextViewOptions({disableBack:!0}),user.intro_quiz?$state.go("tabs.survey-index"):$state.go("tabs.landing")})})["catch"](function(error){$ionicPopup.alert({title:"Error",template:"An error occurred."})})}}),lifeApp.controllers.controller("SurveyCtrl",function($scope,$stateParams,$auth,$http,SecondTierQuestion,RecommendResources,Survey,SurveyQuestion,IntroResponse){var category_id=$stateParams.id,score=0,index=0,totalScore=0,resources=[],scores=[];$scope.user=$auth.user;$auth.user.id;IntroResponse.query().$promise.then(function(responses){function buildQuestion(index){SecondTierQuestion.query({intro_answer_id:responses[index].answer_id,category_id:category_id}).$promise.then(function(results){if(0!=results.length){$scope.end=!1,$scope.showResources=!1,$scope.questions=results;var question_index=0;$scope.data={answers:""},$scope.question=results[question_index],$scope.answers=results[question_index].answers,$scope.next=function(answer){score=answer.score,scores.push(score),score>0&&resources.push(RecommendResources.query({question_id:results[question_index].id})),question_index++,question_index>results.length-1?checkNext(index):($scope.data={answers:""},$scope.question=results[question_index],$scope.answers=results[question_index].answers)}}else checkNext(index)})}function checkNext(index){index++,index>responses.length-1?Survey.query({category_id:category_id}).$promise.then(function(survey){if(0!=survey.length){var s_id=survey[0].id;SurveyQuestion.query({survey_id:s_id}).$promise.then(function(questions){if(0!=questions.length){$scope.questions=questions;var q_index=0;$scope.data={answers:""},$scope.question=questions[q_index],$scope.answers=questions[q_index].answers,$scope.next=function(answer){score=answer.score,scores.push(score),score>0&&resources.push(RecommendResources.query({question_id:questions[q_index].id})),q_index++,q_index>questions.length-1?showResources():($scope.data={answers:""},$scope.question=questions[q_index],$scope.answers=questions[q_index].answers)}}else showResources()})}else showResources()}):buildQuestion(index)}function showResources(){$scope.end=!0;for(var i=0;i<scores.length-1;i++)totalScore+=scores[i];totalScore>0&&($scope.showResources=!0,$scope.showResources=resources)}responses.length&&buildQuestion(index)})}),lifeApp.controllers.controller("SurveyEndPropertiesCtrl",function($scope,Property){Property.get({name:"survey_end"},function(prop){$scope.surveyend=prop})}),lifeApp.controllers.controller("SurveyIndexCtrl",function($scope,$ionicPopup,$http){$http.get(env.apiUrl+"/categories").then(function(resp){$scope.categories=resp.data})}),lifeApp.controllers.controller("UserSessionCtrl",function($scope,$state,$window,$ionicPopup,$auth,$ionicHistory){$scope.user=$auth.user,$scope.data={},$scope.signin=function(){$auth.submitLogin($scope.data).then(function(user){$ionicHistory.nextViewOptions({disableBack:!0}),user.intro_quiz?$state.go("tabs.survey-index"):$state.go("tabs.landing")})["catch"](function(data){console.log(data),$ionicPopup.alert({title:"Error!",template:data.errors})})},$scope.signout=function(){var confirm=$ionicPopup.confirm({title:"Are you sure you want to logout?"});confirm.then(function(result){result&&$auth.signOut().then(function(){$ionicHistory.nextViewOptions({disableBack:!0}),$state.go("tabs.home")})["catch"](function(resp){console.error(resp),$ionicPopup.alert({title:"Error!",template:"There was an error logging you out."})})})}}),lifeApp.application.config(function($authProvider){$authProvider.configure({apiUrl:env.apiUrl,storage:"localStorage"})}),lifeApp.services.factory("AllResources",function($resource){return $resource(env.apiUrl+"/resources")}),lifeApp.services.factory("Category",function($resource){return $resource(env.apiUrl+"/categories/:id")}),lifeApp.services.factory("IntroQuestion",function($resource){return $resource(env.apiUrl+"/intro_questions",null,{complete:{method:"PUT",url:env.apiUrl+"/intro_questions/complete"}})}),lifeApp.services.factory("IntroResponse",function($resource){return $resource(env.apiUrl+"/intro_responses",null,{create:{method:"POST",url:env.apiUrl+"/intro_answers/:intro_answer_id/intro_responses"}})}),lifeApp.services.factory("Property",function($resource){return $resource(env.apiUrl+"/properties/:name")}),lifeApp.services.factory("Question",function($resource){return $resource(env.apiUrl+"/questions/:id",{id:"@id"})}),lifeApp.services.factory("RecommendResources",function($resource){return $resource(env.apiUrl+"/questions/:question_id/resources",{question_id:"@id"})}),lifeApp.services.factory("Resource",function($resource){return $resource(env.apiUrl+"/categories/:category_id/resources",{category_id:"@id"})}),lifeApp.services.factory("Response",function($resource){return $resource(env.apiUrl+"/responses")}),lifeApp.services.factory("SecondTierQuestion",function($resource){return $resource(env.apiUrl+"/categories/:category_id/questions",{category_id:"@category_id",intro_answer_id:"@intro_answer_id"})}),lifeApp.services.factory("Survey",function($resource){return $resource(env.apiUrl+"/categories/:category_id/surveys",{category_id:"@category_id"})}),lifeApp.services.factory("SurveyQuestion",function($resource){return $resource(env.apiUrl+"/surveys/:survey_id/questions",{survey_id:"@survey_id"})}),lifeApp.services.factory("User",function($resource){return $resource(env.apiUrl+"/auth/user")}),lifeApp.services.factory("UserSession",function($resource){return $resource("http://localhost:3000/users/sign_in.json")});